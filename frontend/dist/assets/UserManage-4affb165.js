import{_ as X,Z as ee,o as ae,E as m,r as s,b as L,c as le,e as w,d as a,w as l,g as d,n as M,Y as N,f as _,A as T,m as te,z as ne}from"./index-7d284294.js";const oe={class:"user-manage-page"},se={class:"card-header"},re={class:"pagination",style:{"margin-top":"20px"}},ue={class:"dialog-footer"},ie={__name:"UserManage",setup(de){const{proxy:B}=ee(),k=B.$request,I=d([]),A=d(0),c=d(1),y=d(10),b=d(""),V=d(""),C=d(""),f=d(!1),S=d("新增用户"),o=d({}),h=d(null),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3-20之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],is_admin:[{required:!0,message:"请选择用户类型",trigger:"change"}]};async function g(){try{const n=await k.get("/api/admin/users");let e=[];if(Array.isArray(n)?e=n:n.code===200&&Array.isArray(n.data)&&(e=n.data),console.log("用户数据:",e),b.value){const u=b.value.toLowerCase();e=e.filter(i=>i.username.toLowerCase().includes(u))}if(V.value){const u=V.value.toLowerCase();e=e.filter(i=>i.email.toLowerCase().includes(u))}if(C.value){const u=parseInt(C.value);e=e.filter(i=>i.is_admin===!0||i.is_admin===1?1:u===0)}A.value=e.length;const p=(c.value-1)*y.value,r=p+y.value;I.value=e.slice(p,r)}catch(n){console.error("Load users error:",n),m.error("加载用户列表失败，请重试")}}function z(){c.value=1,g()}function P(){b.value="",V.value="",C.value="",c.value=1,g()}function R(n){y.value=n,c.value=1,g()}function j(n){c.value=n,g()}function F(){S.value="新增用户",o.value={username:"",email:"",password:"",is_admin:"0"},f.value=!0}function J(n){S.value="编辑用户",o.value={id:n.id,username:n.username,email:n.email,is_admin:n.is_admin.toString()},f.value=!0}async function O(){if(h.value)try{if(await h.value.validate(),o.value.id){const n=await k.put(`/api/admin/users/${o.value.id}`,{is_admin:parseInt(o.value.is_admin)});n.code===200?(m.success("编辑用户角色成功"),f.value=!1,g()):m.error("操作失败："+n.msg)}else m.info("新增用户功能暂不可用"),f.value=!1}catch(n){console.error("Save user error:",n),m.error("操作失败，请重试")}}async function Y(n){try{const e=await k.put(`/api/admin/users/${n.id}`,{is_admin:n.is_admin?0:1});e.code===200?(m.success(`用户已${n.is_admin?"禁用":"启用"}`),g()):m.error("操作失败："+e.msg)}catch(e){console.error("Toggle user status error:",e),m.error("操作失败，请重试")}}return ae(()=>{let n=!1;try{const e=localStorage.getItem("is_admin");n=e==="1"||e===1||e===!0;const p=localStorage.getItem("user");if(p){const r=JSON.parse(p);(r.is_admin===1||r.is_admin===!0)&&(n=!0)}}catch{n=!1}if(!n){m.error("无管理员权限，即将返回登录页"),setTimeout(()=>{window.location.href="/login"},1500);return}g()}),(n,e)=>{const p=s("el-icon"),r=s("el-button"),u=s("el-input"),i=s("el-col"),U=s("el-option"),$=s("el-select"),q=s("el-row"),E=s("el-card"),v=s("el-table-column"),Z=s("el-tag"),G=s("el-table"),H=s("el-pagination"),x=s("el-form-item"),K=s("el-form"),Q=s("el-dialog");return L(),le("div",oe,[e[18]||(e[18]=w("h2",{class:"page-title"},"用户管理",-1)),a(E,{style:{"margin-bottom":"20px"}},{default:l(()=>[a(q,{gutter:20},{default:l(()=>[a(i,{span:8},{default:l(()=>[a(u,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),placeholder:"搜索用户名",clearable:""},{append:l(()=>[a(r,{onClick:z},{default:l(()=>[a(p,null,{default:l(()=>[a(M(N))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(i,{span:8},{default:l(()=>[a(u,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),placeholder:"搜索邮箱",clearable:""},{append:l(()=>[a(r,{onClick:z},{default:l(()=>[a(p,null,{default:l(()=>[a(M(N))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(i,{span:8},{default:l(()=>[a($,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),placeholder:"用户状态",clearable:""},{default:l(()=>[a(U,{label:"启用",value:"1"}),a(U,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(q,{gutter:20,style:{"margin-top":"10px"}},{default:l(()=>[a(i,{span:24,style:{"text-align":"right"}},{default:l(()=>[a(r,{type:"primary",onClick:z},{default:l(()=>[...e[11]||(e[11]=[_("搜索",-1)])]),_:1}),a(r,{type:"info",onClick:P},{default:l(()=>[...e[12]||(e[12]=[_("重置筛选",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(E,null,{header:l(()=>[w("div",se,[e[14]||(e[14]=w("span",null,"用户列表",-1)),a(r,{type:"success",onClick:F},{default:l(()=>[...e[13]||(e[13]=[_("新增用户",-1)])]),_:1})])]),default:l(()=>[a(G,{data:I.value,style:{width:"100%"}},{default:l(()=>[a(v,{prop:"id",label:"用户ID",width:"80"}),a(v,{prop:"username",label:"用户名",width:"180"}),a(v,{prop:"email",label:"邮箱",width:"250"}),a(v,{prop:"is_admin",label:"用户状态",width:"120"},{default:l(({row:t})=>[a(Z,{type:t.is_admin===!0||t.is_admin===1?"success":"danger"},{default:l(()=>[_(T(t.is_admin===!0||t.is_admin===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(v,{prop:"created_at",label:"注册时间",width:"200"}),a(v,{label:"操作",width:"240",fixed:"right"},{default:l(({row:t})=>[a(r,{size:"small",type:"primary",onClick:W=>J(t)},{default:l(()=>[...e[15]||(e[15]=[_("编辑",-1)])]),_:1},8,["onClick"]),a(r,{size:"small",type:t.is_admin===!0||t.is_admin===1?"warning":"success",onClick:W=>Y(t)},{default:l(()=>[_(T(t.is_admin===!0||t.is_admin===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"]),w("div",re,[a(H,{"current-page":c.value,"onUpdate:currentPage":e[3]||(e[3]=t=>c.value=t),"page-size":y.value,"onUpdate:pageSize":e[4]||(e[4]=t=>y.value=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:A.value,onSizeChange:R,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1}),a(Q,{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=t=>f.value=t),title:S.value,width:"500px"},{footer:l(()=>[w("span",ue,[a(r,{onClick:e[9]||(e[9]=t=>f.value=!1)},{default:l(()=>[...e[16]||(e[16]=[_("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:O},{default:l(()=>[...e[17]||(e[17]=[_("保存",-1)])]),_:1})])]),default:l(()=>[a(K,{model:o.value,rules:D,ref_key:"formRef",ref:h,"label-width":"80px"},{default:l(()=>[a(x,{label:"用户名",prop:"username"},{default:l(()=>[a(u,{modelValue:o.value.username,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(x,{label:"邮箱",prop:"email"},{default:l(()=>[a(u,{modelValue:o.value.email,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o.value.id?ne("",!0):(L(),te(x,{key:0,label:"密码"},{default:l(()=>[a(u,{modelValue:o.value.password,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.password=t),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a(x,{label:"用户类型",prop:"is_admin"},{default:l(()=>[a($,{modelValue:o.value.is_admin,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.is_admin=t),placeholder:"请选择用户类型"},{default:l(()=>[a(U,{label:"普通用户",value:"0"}),a(U,{label:"管理员",value:"1"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=X(ie,[["__scopeId","data-v-0dbc5107"]]);export{pe as default};
