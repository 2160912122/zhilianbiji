import{_ as L,u as N,a as V,o as q,r as n,b as g,c as A,e as a,d as t,w as e,F as y,n as F,G as T,f as _,A as f,m as C,H as U,I as j,g as I}from"./index-911a223c.js";const z={class:"dashboard"},H={class:"page-header"},M={class:"header-content"},J={class:"header-actions"},K={class:"stat-content no-scrollbar"},O={class:"stat-info"},Q={class:"stat-value"},W={class:"stat-content no-scrollbar"},X={class:"stat-info"},Y={class:"stat-value"},Z={class:"stat-content no-scrollbar"},tt={class:"stat-info"},st={class:"stat-value"},et={class:"stat-content no-scrollbar"},at={class:"stat-info"},ot={class:"stat-value"},lt={class:"stat-content no-scrollbar"},nt={class:"stat-info"},it={class:"stat-value"},rt={class:"quick-actions"},dt={__name:"Dashboard",setup(ct){N();const $=V();q(async()=>{if(localStorage.getItem("token")&&!$.user)try{await $.fetchCurrentUser(),console.log("用户信息加载成功：",$.user)}catch(l){console.warn("用户信息加载失败：",l),localStorage.removeItem("token"),window.location.href="/login"}});const p=I({notes:0,tables:0,whiteboards:0,mindmaps:0,flowcharts:0}),h=I([]);async function S(){try{const[l,s,i,u,k]=await Promise.all([y.get("/api/notes"),y.get("/api/tables"),y.get("/api/whiteboards"),y.get("/api/mindmaps"),y.get("/api/flowcharts")]),r=o=>{if(console.log("处理API响应数据:",o),o&&typeof o=="object"){if(o.code===200&&Array.isArray(o.data))return o.data;if(Array.isArray(o))return o}return[]},d=r(l),m=r(s),b=r(i),v=r(u),w=r(k);p.value={notes:d.length,tables:m.length,whiteboards:b.length,mindmaps:v.length,flowcharts:w.length},console.log("仪表盘数据:",p.value),h.value=[...d.slice(0,2).map(o=>({...o,type:"note"})),...m.slice(0,2).map(o=>({...o,type:"table"})),...b.slice(0,2).map(o=>({...o,type:"whiteboard"})),...v.slice(0,2).map(o=>({...o,type:"mindmap"})),...w.slice(0,2).map(o=>({...o,type:"flowchart"}))].sort((o,D)=>new Date(D.updated_at||0)-new Date(o.updated_at||0)).slice(0,5),console.log("最近更新内容:",h.value)}catch(l){console.error("加载数据失败:",l)}}function R(l){return{note:`/notes/${l.id}`,table:`/tables/${l.id}`,whiteboard:`/whiteboards/${l.id}`,mindmap:`/mindmaps/${l.id}`,flowchart:`/flowcharts/${l.id}`}[l.type]||"#"}function B(l){return{note:"笔记",table:"表格",whiteboard:"白板",mindmap:"脑图",flowchart:"流程图"}[l]||l}return q(()=>{S()}),(l,s)=>{const i=n("el-icon"),u=n("el-button"),k=n("Document"),r=n("el-card"),d=n("el-col"),m=n("Grid"),b=n("EditPen"),v=n("Connection"),w=n("Share"),o=n("el-row"),D=n("el-empty"),P=n("el-link"),x=n("el-tag"),E=n("el-timeline-item"),G=n("el-timeline");return g(),A("div",z,[a("div",H,[a("div",M,[s[7]||(s[7]=a("h1",{class:"page-title"},"仪表盘",-1)),a("div",J,[s[6]||(s[6]=a("p",{class:"page-desc"},"欢迎回来，这里是您的个人数据概览",-1)),t(u,{type:"primary",onClick:S},{default:e(()=>[t(i,null,{default:e(()=>[t(F(T))]),_:1}),s[5]||(s[5]=_(" 刷新数据 ",-1))]),_:1})])])]),t(o,{gutter:20},{default:e(()=>[t(d,{span:4},{default:e(()=>[t(r,{class:"stat-card no-scrollbar"},{default:e(()=>[a("div",K,[t(i,{class:"stat-icon",color:"#409eff"},{default:e(()=>[t(k)]),_:1}),a("div",O,[a("div",Q,f(p.value.notes||0),1),s[8]||(s[8]=a("div",{class:"stat-label"},"我的笔记总数",-1))])])]),_:1})]),_:1}),t(d,{span:4},{default:e(()=>[t(r,{class:"stat-card no-scrollbar"},{default:e(()=>[a("div",W,[t(i,{class:"stat-icon",color:"#67c23a"},{default:e(()=>[t(m)]),_:1}),a("div",X,[a("div",Y,f(p.value.tables||0),1),s[9]||(s[9]=a("div",{class:"stat-label"},"我的表格总数",-1))])])]),_:1})]),_:1}),t(d,{span:4},{default:e(()=>[t(r,{class:"stat-card no-scrollbar"},{default:e(()=>[a("div",Z,[t(i,{class:"stat-icon",color:"#e6a23c"},{default:e(()=>[t(b)]),_:1}),a("div",tt,[a("div",st,f(p.value.whiteboards||0),1),s[10]||(s[10]=a("div",{class:"stat-label"},"我的白板总数",-1))])])]),_:1})]),_:1}),t(d,{span:4},{default:e(()=>[t(r,{class:"stat-card no-scrollbar"},{default:e(()=>[a("div",et,[t(i,{class:"stat-icon",color:"#f56c6c"},{default:e(()=>[t(v)]),_:1}),a("div",at,[a("div",ot,f(p.value.mindmaps||0),1),s[11]||(s[11]=a("div",{class:"stat-label"},"我的脑图总数",-1))])])]),_:1})]),_:1}),t(d,{span:4},{default:e(()=>[t(r,{class:"stat-card no-scrollbar"},{default:e(()=>[a("div",lt,[t(i,{class:"stat-icon",color:"#909399"},{default:e(()=>[t(w)]),_:1}),a("div",nt,[a("div",it,f(p.value.flowcharts||0),1),s[12]||(s[12]=a("div",{class:"stat-label"},"我的流程图总数",-1))])])]),_:1})]),_:1})]),_:1}),t(o,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[t(d,{span:12},{default:e(()=>[t(r,null,{header:e(()=>[...s[13]||(s[13]=[a("div",{class:"card-header"},[a("span",null,"快速创建")],-1)])]),default:e(()=>[a("div",rt,[t(u,{type:"primary",onClick:s[0]||(s[0]=c=>l.$router.push("/notes/new")),class:"quick-action-btn"},{default:e(()=>[t(i,null,{default:e(()=>[t(k)]),_:1}),s[14]||(s[14]=_(" 新建笔记 ",-1))]),_:1}),t(u,{type:"success",onClick:s[1]||(s[1]=c=>l.$router.push("/tables/new")),class:"quick-action-btn"},{default:e(()=>[t(i,null,{default:e(()=>[t(m)]),_:1}),s[15]||(s[15]=_(" 新建表格 ",-1))]),_:1}),t(u,{type:"warning",onClick:s[2]||(s[2]=c=>l.$router.push("/whiteboards/new")),class:"quick-action-btn"},{default:e(()=>[t(i,null,{default:e(()=>[t(b)]),_:1}),s[16]||(s[16]=_(" 新建白板 ",-1))]),_:1}),t(u,{type:"danger",onClick:s[3]||(s[3]=c=>l.$router.push("/mindmaps/new")),class:"quick-action-btn"},{default:e(()=>[t(i,null,{default:e(()=>[t(v)]),_:1}),s[17]||(s[17]=_(" 新建脑图 ",-1))]),_:1}),t(u,{type:"info",onClick:s[4]||(s[4]=c=>l.$router.push("/flowcharts/new")),class:"quick-action-btn"},{default:e(()=>[t(i,null,{default:e(()=>[t(w)]),_:1}),s[18]||(s[18]=_(" 新建流程图 ",-1))]),_:1})])]),_:1})]),_:1}),t(d,{span:12},{default:e(()=>[t(r,null,{header:e(()=>[...s[19]||(s[19]=[a("div",{class:"card-header"},[a("span",null,"最近更新")],-1)])]),default:e(()=>[h.value.length===0?(g(),C(D,{key:0,description:"暂无内容"})):(g(),C(G,{key:1},{default:e(()=>[(g(!0),A(U,null,j(h.value,c=>(g(),C(E,{key:c.id,timestamp:c.updated_at,placement:"top"},{default:e(()=>[t(P,{href:R(c),type:"primary"},{default:e(()=>[_(f(c.title),1)]),_:2},1032,["href"]),t(x,{size:"small",style:{"margin-left":"10px"}},{default:e(()=>[_(f(B(c.type)),1)]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1}))]),_:1})]),_:1})]),_:1})])}}},_t=L(dt,[["__scopeId","data-v-3467f827"]]);export{_t as default};
