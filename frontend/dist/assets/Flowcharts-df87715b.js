import{_ as K,u as O,l as P,o as X,r,b as c,c as w,d as a,w as o,g as p,F as k,E as d,e as i,n as B,W as Z,f as n,Y as ee,H as D,I as A,A as $,D as le,m as E}from"./index-7d284294.js";const te={class:"flowcharts-page"},ae={class:"card-header"},oe={class:"header-buttons"},ne={class:"search-bar"},se={class:"filter-bar"},re={key:0,class:"share-url-container"},ie={key:1},ue={class:"dialog-footer"},de={__name:"Flowcharts",setup(ce){const U=O(),v=p([]),h=p(""),g=p([]),b=p(!1),C=p(!1),f=p(""),V=p(null);let x=null;async function y(){try{const l={};h.value&&(l.search=h.value),g.value.length>0&&(l.tag_ids=g.value.join(","));const e=await k.get("/api/flowcharts",{params:l});v.value=e.data||[]}catch(l){console.error("Load flowcharts error:",l),d.error("加载流程图列表失败"),v.value=[]}}function M(){x&&clearTimeout(x),x=setTimeout(()=>{y()},300)}function I(){y()}function N(l){U.push(`/flowcharts/${l}`)}async function S(l){try{await k.post(`/api/flowcharts/${l}/duplicate`,{}),d.success("复制成功"),y()}catch(e){console.error("Duplicate flowchart error:",e),d.error("复制失败")}}async function L(l){V.value=l,b.value=!0,f.value=""}async function z(){if(V.value){C.value=!0;try{const l=await k.post(`/api/flowcharts/${V.value}/share`,{days:7});f.value=`${window.location.origin}${l.share_url}`,d.success("分享链接已生成")}catch(l){console.error("分享失败:",l),d.error("分享失败")}finally{C.value=!1}}}function j(){navigator.clipboard.writeText(f.value),d.success("链接已复制到剪贴板")}async function q(l){try{await le.confirm("确定要删除这个流程图吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.delete(`/api/flowcharts/${l}`),d.success("删除成功"),y()}catch(e){e!=="cancel"&&(console.error("Delete flowchart error:",e),d.error("删除失败"))}}function H(l){return l?new Date(l).toLocaleString("zh-CN"):""}const Q=P(()=>{const l=new Map;return Array.isArray(v.value)&&v.value.forEach(e=>{e.tags&&Array.isArray(e.tags)&&e.tags.forEach(s=>{l.has(s.id)?l.get(s.id).count++:l.set(s.id,{id:s.id,name:s.name,count:1})})}),Array.from(l.values()).sort((e,s)=>s.count-e.count)});return X(()=>{y()}),(l,e)=>{const s=r("el-icon"),u=r("el-button"),F=r("el-input"),R=r("el-option"),W=r("el-select"),_=r("el-table-column"),T=r("el-tag"),Y=r("el-table"),G=r("el-card"),J=r("el-dialog");return c(),w("div",te,[a(G,null,{header:o(()=>[i("div",ae,[e[7]||(e[7]=i("span",null,"流程图列表",-1)),i("div",oe,[a(u,{type:"primary",onClick:e[0]||(e[0]=t=>l.$router.push("/flowcharts/new"))},{default:o(()=>[a(s,null,{default:o(()=>[a(B(Z))]),_:1}),e[6]||(e[6]=n(" 新建流程图 ",-1))]),_:1})])])]),default:o(()=>[i("div",ne,[a(F,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"搜索流程图标题或描述",clearable:"",onInput:M},{prefix:o(()=>[a(s,null,{default:o(()=>[a(B(ee))]),_:1})]),_:1},8,["modelValue"])]),i("div",se,[a(W,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"按标签筛选",clearable:"",onChange:I,style:{width:"300px"}},{default:o(()=>[(c(!0),w(D,null,A(Q.value,t=>(c(),E(R,{key:t.id,label:`${t.name} (${t.count})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a(Y,{data:v.value,style:{width:"100%"}},{default:o(()=>[a(_,{prop:"title",label:"标题","min-width":"200"}),a(_,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),a(_,{label:"标签",width:"200"},{default:o(({row:t})=>[(c(!0),w(D,null,A(t.tags,m=>(c(),E(T,{key:m.id,size:"small",type:"info",style:{"margin-right":"5px"}},{default:o(()=>[n($(m.name),1)]),_:2},1024))),128))]),_:1}),a(_,{prop:"is_public",label:"公开",width:"80"},{default:o(({row:t})=>[a(T,{type:t.is_public?"success":"info"},{default:o(()=>[n($(t.is_public?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"updated_at",label:"更新时间",width:"180"},{default:o(({row:t})=>[n($(H(t.updated_at)),1)]),_:1}),a(_,{label:"操作",width:"250",fixed:"right"},{default:o(({row:t})=>[a(u,{link:"",type:"primary",onClick:m=>N(t.id)},{default:o(()=>[...e[8]||(e[8]=[n("编辑",-1)])]),_:1},8,["onClick"]),a(u,{link:"",type:"success",onClick:m=>S(t.id)},{default:o(()=>[...e[9]||(e[9]=[n("复制",-1)])]),_:1},8,["onClick"]),a(u,{link:"",type:"warning",onClick:m=>L(t.id)},{default:o(()=>[...e[10]||(e[10]=[n("分享",-1)])]),_:1},8,["onClick"]),a(u,{link:"",type:"danger",onClick:m=>q(t.id)},{default:o(()=>[...e[11]||(e[11]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(J,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t),title:"分享流程图",width:"500px"},{footer:o(()=>[i("span",ue,[a(u,{onClick:e[4]||(e[4]=t=>b.value=!1)},{default:o(()=>[...e[16]||(e[16]=[n("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:z,loading:C.value},{default:o(()=>[...e[17]||(e[17]=[n("确认分享",-1)])]),_:1},8,["loading"])])]),default:o(()=>[f.value?(c(),w("div",re,[e[13]||(e[13]=i("p",null,"分享链接已生成：",-1)),a(F,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),readonly:""},{append:o(()=>[a(u,{onClick:j},{default:o(()=>[...e[12]||(e[12]=[n("复制",-1)])]),_:1})]),_:1},8,["modelValue"]),e[14]||(e[14]=i("p",{style:{"margin-top":"10px",color:"#666"}},"该链接有效期为7天",-1))])):(c(),w("div",ie,[...e[15]||(e[15]=[i("p",null,"确定要分享这个流程图吗？",-1)])]))]),_:1},8,["modelValue"])])}}},fe=K(de,[["__scopeId","data-v-d0c1d3d9"]]);export{fe as default};
